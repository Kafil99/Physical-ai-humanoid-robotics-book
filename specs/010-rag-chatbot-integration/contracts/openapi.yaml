openapi: 3.0.0
info:
  title: RAG Chatbot API
  version: 1.0.0
  description: API for the RAG chatbot to answer questions about the book content.

paths:
  /chat:
    post:
      summary: Get an answer from the chatbot
      operationId: chat_post
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChatPayload'
      responses:
        '200':
          description: Successful response from the agent
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentResponse'
        '400':
          description: Bad Request (e.g., invalid payload)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal Server Error (e.g., agent failure)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    ChatPayload:
      type: object
      properties:
        question:
          type: string
          description: The question asked by the user.
        selected_text:
          type: string
          description: The block of text the user selected on the page, if any.
      required:
        - question

    AgentResponse:
      type: object
      properties:
        answer:
          type: string
          description: The answer generated by the RAG agent.
        mode:
          type: string
          enum: [global_rag, selected_text]
          description: The execution mode used by the agent.
      required:
        - answer
        - mode

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
          description: A description of the error that occurred.
      required:
        - error
